<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    (function () {
      // Check if the current URL contains "github"
      if (!window.location.href.includes("github")) {
        // Helper function to modify and reload elements with cache busting
        function reloadElementWithCacheBust(element, attribute) {
          let attrValue = element.getAttribute(attribute);
          if (attrValue && attrValue.includes("/learningwithwick")) {
            // Replace '/learningwithwick' with an empty string
            let newAttrValue = attrValue.replace("/learningwithwick", "");

            // Add cache-busting parameter to force reload
            const cacheBustParam = `?cb=${new Date().getTime()}`;
            const updatedAttrValue = newAttrValue.includes("?")
              ? newAttrValue + "&" + cacheBustParam
              : newAttrValue + cacheBustParam;

            element.setAttribute(attribute, updatedAttrValue);

            // For script tags, we need to re-inject them to execute again
            if (element.tagName.toLowerCase() === "script") {
              const clone = document.createElement("script");
              clone.src = updatedAttrValue;
              clone.async = element.async;
              clone.defer = element.defer;
              element.parentNode.replaceChild(clone, element);
            }
          }
        }

        // Modify link and script tags in the head (stylesheets, JS)
        const headElements = document.querySelectorAll('link[href], script[src]');
        headElements.forEach(element => {
          if (element.hasAttribute('href')) {
            reloadElementWithCacheBust(element, 'href');
          }
          if (element.hasAttribute('src')) {
            reloadElementWithCacheBust(element, 'src');
          }
        });

        // After DOM content is loaded, modify other body elements (images, iframes, etc.)
        document.addEventListener('DOMContentLoaded', function () {
          const bodyElements = document.querySelectorAll('[src], [href], [id]');
          bodyElements.forEach(element => {
            if (element.hasAttribute('src')) {
              reloadElementWithCacheBust(element, 'src');
            }
            if (element.hasAttribute('href')) {
              reloadElementWithCacheBust(element, 'href');
            }
            if (element.hasAttribute('id')) {
              reloadElementWithCacheBust(element, 'id');
            }
          });
        });

        console.log("Paths modified and resources reloaded with cache-busting for GitHub Pages");
      }
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Wick Learning</title>
  <link rel='icon' type='image/x-icon' href='/learningwithwick/media/logo.png'>
  <link rel="stylesheet" href="/learningwithwick/style.css">
  <script src="https://kit.fontawesome.com/0303383be9.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class='loading-overlay' id='loading-overlay'></div>

  <div class='main-container'>

    <h4 class='welcome-back-text'>
      Welcome Back,
    </h4>

    <h1 class='welcome-back-name' id='welcome-back-name'>
      OnlyTwentyCharacters
    </h1>

    <div class='last-played' id='last-played'>
      <h1>
        Recently Played:
        </h2>

        <h2>
          Chapter 1 Quiz
        </h2>

        <button class='last-played-button' id='/learningwithwick/practice/games/chapter/1/quiz/'>
          <i class='fas fa-play'></i>
          Play Now
        </button>

        <i class='fa-solid fa-id-card' id='ico'></i>
    </div>

  </div>

  <div class='sidebar'>

    <div class='sidebar-logo'>
      <img class='logo' src='/learningwithwick/media/logo.png'>
      <h1>Wick</h1>
    </div>

    <div class='sidebar-buttons-container' id='sidebar-buttons-container'>
      <button class='sidebar-button current' id='/learningwithwick/'>
        <i class="fa-regular fa-map"></i>
        Home
      </button>

      <button class='sidebar-button' id='/learningwithwick/practice/games' style='background-color: transparent;'>
        <i class="fa-regular fa-flag"></i>
        Practice
      </button>

      <button class='sidebar-button' id='/learningwithwick/statistics/' style='background-color: transparent;'>
        <i class="fa-regular fa-chart-bar"></i>
        Statistics
      </button>

      <button class='sidebar-button' style='background-color: transparent;'>
        <i class='fa-classic fa-calendar'></i>
        Schedule
      </button>

      <button class='sidebar-button' style='background-color: transparent;'>
        <i class="fa-regular fa-pen-to-square"></i>
        Settings
      </button>

      <div class='sidebar-bottom'>
        <h4>
          Have any problems with Learning with Wick? Contact our customer support!
        </h4>

        <button id='support-button'>
          Contact Us
        </button>
      </div>
    </div>
  </div>

  <div class='profile-sidebar'>
    <div class='top-container'>

    </div>
  </div>

  <script src='/learningwithwick/scripts/loading.js'></script>
  <script>
    let dataset = ['fa-solid fa-id-card', 'fa-solid fa-helmet-safety', 'fa-solid fa-traffic-light', 'fa-solid fa-gauge'];
    let lastPlayed = localStorage.getItem('last-played');
    let icon = (lastPlayed !== null) ? dataset[(lastPlayed - 1)] : dataset[0];
    document.getElementById('ico').className = icon;
    if (localStorage.getItem('last-played')) {
      document.querySelector('.last-played > h2').textContent = `Chapter ${lastPlayed} Quiz`;
      lastPlayed = `/learningwithwick/practice/games/chapter/${lastPlayed}/quiz/`;
    } else {
      document.querySelector('.last-played > h1').textContent = 'We Recommend:';
      document.querySelector('.last-played > h2').textContent = `Chapter ${1} Quiz`;
      lastPlayed = '/learningwithwick/practice/games/chapter/1/quiz/';
    }

    for (let child of document.getElementById('last-played').children) {
      if (child.className === 'last-played-button') {
        child.onclick = function () {
          setTimeout(() => {
            location.href = lastPlayed;
          }, 250);
        }
      }
    }
  </script>
</body>

</html>