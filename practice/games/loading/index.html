<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading - Learning with Wick</title>
  <link rel='icon' type='image/x-icon' href='/learningwithwick/media/logo.png'>
  <link rel="stylesheet" href="/learningwithwick/practice/games/loading/style.css">
</head>
<body>
  <div class="loader">
    <div class="loaderMiniContainer">
      <div class="barContainer">
        <span class="bar"></span>
        <span class="bar bar2"></span>
      </div>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 101 114"
        class="svgIcon"
      >
        <circle
          stroke-width="7"
          stroke="black"
          transform="rotate(36.0692 46.1726 46.1727)"
          r="29.5497"
          cy="46.1727"
          cx="46.1726"
        ></circle>
        <line
          stroke-width="7"
          stroke="black"
          y2="111.784"
          x2="97.7088"
          y1="67.7837"
          x1="61.7089"
        ></line>
      </svg>
    </div>
  </div>

  <script>
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function getChapterData(chapterId) {
      let storedStats = JSON.parse(localStorage.getItem('stats')) || {};
      return storedStats[chapterId] || null;
    }

    function calculateChapterStatistics(chapterId) {
      let chapterData = getChapterData(chapterId);
    
      if (!chapterData) {
        console.log("No data available for this chapter.");
        return null;
      }

      let averageScore = chapterData.totalScore / chapterData.numQuizzes;
      let averageAccuracy = chapterData.totalAccuracy / chapterData.numQuizzes;
    
      return {
        averageScore: averageScore.toFixed(2),
        averageAccuracy: averageAccuracy.toFixed(2),
        bestScore: chapterData.bestScore,
        worstScore: chapterData.worstScore,
        totalQuizzes: chapterData.numQuizzes,
        totalTimeSpent: chapterData.totalTimeSpent
      };
    }

    let chapterStats = calculateChapterStatistics('chapter_' + lcoalStorage.getItem('last-played'));
    console.log(chapterStats);

    function getBestAndWorstQuizzes(chapterId) {
      let chapterData = getChapterData(chapterId);
    
      if (!chapterData) {
        console.log("No data available for this chapter.");
        return null;
      }

      let bestQuiz = chapterData.quizzes.reduce((best, current) => 
        current.score > best.score ? current : best
      , chapterData.quizzes[0]);

      let worstQuiz = chapterData.quizzes.reduce((worst, current) => 
        current.score < worst.score ? current : worst
      , chapterData.quizzes[0]);

      return { bestQuiz, worstQuiz };
    }

    let bestAndWorst = getBestAndWorstQuizzes('chapter_' + localStorage.getItem('last-played'));
    console.log(bestAndWorst);

    function calculatePerformanceImprovement(chapterId) {
      let chapterData = getChapterData(chapterId);

      if (!chapterData || chapterData.quizzes.length < 2) {
        console.log("Not enough data to calculate improvement.");
        return null;
      }

      let firstQuiz = chapterData.quizzes[0];
      let lastQuiz = chapterData.quizzes[chapterData.quizzes.length - 1];

      let scoreImprovement = ((lastQuiz.score - firstQuiz.score) / firstQuiz.score) * 100;
      let accuracyImprovement = ((lastQuiz.accuracy - firstQuiz.accuracy) / firstQuiz.accuracy) * 100;

      return {
        scoreImprovement: scoreImprovement.toFixed(2) + "%",
        accuracyImprovement: accuracyImprovement.toFixed(2) + "%"
      };
    }

    let improvement = calculatePerformanceImprovement('chapter_' + localStorage.getItem('last-played'));
    console.log(improvement);

    async function main() {
      await delay(3000);

      const updatedData = processNewQuizData(quizData, newData);

      const statistics = calculateStatistics(updatedData);

      console.log('Statistics:', statistics);

      sessionStorage.setItem('statistics', JSON.stringify(statistics));

      window.location.href = '/learningwithwick/';
    }

    main();
  </script>
</body>
</html>
